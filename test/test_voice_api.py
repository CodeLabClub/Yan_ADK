# coding: utf-8

"""
    Yanshee RESTful API

     ## Overview Yanshee RESTful APIs are generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project. By using the [OpenAPI-Spec](https://github.com/swagger-api/swagger-core/wiki) from a remote server. The API service uses the [Connexion](https://github.com/zalando/connexion) library on top of Flask.  To provide the API service, Yanshee RESTful APIs are integrated into apollo package, it is a part of Yanshee-ROS framework. Yanshee RESTful APIs provided two language versions: - [English version](https://app.swaggerhub.com/apis-docs/UBTEDU/apollo_en/1.0.0) - [Chinese version](https://app.swaggerhub.com/apis-docs/UBTEDU/apollo_cn/1.0.0)  ## Requirements. Python 2.7 or 3.4+  ## Getting Started Please follow the [installation procedure](#installation--usage) and then run the following:  ``` from __future__ import print_function import time import openadk from openadk.rest import ApiException from pprint import pprint  # create an instance of the API class configuration = openadk.Configuration() configuration.host = 'http://192.168.1.100:9090/v1' api_instance = openadk.DevicesApi(openadk.ApiClient(configuration)) try:  # Get system's battery information  api_response = api_instance.get_devices_battery()  pprint(api_response) except ApiException as e:  print(\"Exception when calling DevicesApi->get_devices_battery: %s\" % e)  ```   # noqa: E501

    OpenAPI spec version: 1.0.0
    Contact: swenggroup@ubtrobot.com
    Generated by: https://github.com/swagger-api/swagger-codegen.git
"""


from __future__ import absolute_import

import unittest
from pprint import pprint

import openadk
from openadk.api.voice_api import VoiceApi  # noqa: E501
from openadk.models.voice_asr_option import VoiceAsrOption
from openadk.rest import ApiException
import time
from openadk.models.voice_iat_request import VoiceIatRequest
from openadk.models.voice_tts_str import VoiceTTSStr
from openadk.models.voice_post_offline_syntax import VoicePostOfflineSyntax
from openadk.models.voice_offline_slot import VoiceOfflineSlot
from openadk.models.voice_offline_syntax_rule import VoiceOfflineSyntaxRule
from openadk.models.voice_delete_offline_syntax import VoiceDeleteOfflineSyntax


class TestVoiceApi(unittest.TestCase):
    """VoiceApi unit test stubs"""

    def setUp(self):
        self.configuration = openadk.Configuration()
        self.configuration.host = 'http://10.10.60.131:9090/v1'
        self.api_instance = VoiceApi(openadk.ApiClient(self.configuration))  # noqa: E501

    def tearDown(self):
        pass

    def test_delete_voice_asr(self):
        """Test case for delete_voice_asr

        Stop automatic speech recognition  # noqa: E501
        """
        timestamp = int(time.time())
        body = VoiceAsrOption(continues=True, timestamp=timestamp)
        self.api_instance.put_voice_asr(body=body)

        ret = self.api_instance.delete_voice_asr()
        self.assertEqual(ret.code, 0, ret)

    def test_delete_voice_iat(self):
        """Test case for delete_voice_iat

        Stop auto transform  # noqa: E501
        """
        timestamp = int(time.time())
        body = VoiceIatRequest(timestamp=timestamp)
        ret = self.api_instance.put_voice_iat(body=body)
        self.assertEqual(ret.code, 0, ret)

        ret = self.api_instance.delete_voice_iat()
        self.assertEqual(ret.code, 0, ret)

    def test_delete_voice_offline_syntax(self):
        """Test case for delete_voice_offline_syntax

        Delete a offline grammar based offline grammar's name  # noqa: E501
        """
        # create offline_syntax
        rules = [
                    {
                        "name": "want",
                        "value": "我想|我要|请|帮我|我想要|请帮我"
                    },
                    {
                        "name": "dialpre",
                        "value": "打电话给!id(10001)|打给!id(10001)|拨打!id(10001)|拨打电话给!id(10001)|呼叫!id(10001)| 打一个电话给!id(10001)|打个电话给!id(10001)|给|拨通!id(10001)| 接通!id(10001)|呼叫!id(10001)|呼叫给!id(10001)|打!id(10001)"
                    },
                    {
                        "name": "contact",
                        "value": "丁伟"
                    },
                    {
                        "name": "dialsuf",
                        "value": "打电话!id(10001)|打个电话!id(10001)|打一个电话!id(10001)| 拨打电话!id(10001)|拨电话!id(10001)|拨个电话!id(10001)|呼个电话!id(10001)| 的电话!id(10001)|的号码!id(10001)|的手机!id(10001)| 的办公电话!id(10001)|的移动号码!id(10001)|的联通号码!id(10001)| 的电信号码!id(10001)|客服电话!id(10001)"
                    }
                ]
        grammar = str(int(time.time()))
        slot = []
        for rule in rules:
            slot.append(VoiceOfflineSlot(name=rule['name']))
        start = grammar + 'Start'
        startinfo = ''
        for r in rules:
            if r == rules[0] or r == rules[-1]:
                startinfo += '[<' + r['name'] + '>]'
            else:
                startinfo += '<' + r['name'] + '>'
            startinfo += '|' if r != rules[-1] else ''
        rule = []
        for r in rules:
            temp = VoiceOfflineSyntaxRule(name=r['name'], value=r['value'])
            rule.append(temp)
        body = VoicePostOfflineSyntax(grammar=grammar, slot=slot, start=start, startinfo=startinfo, rule=rule)
        ret = self.api_instance.post_voice_offline_syntax(body=body)
        self.assertEqual(ret.code, 0, ret)

        # delete offline_syntax
        body = VoiceDeleteOfflineSyntax(grammar=grammar)
        ret = self.api_instance.delete_voice_offline_syntax(body=body)
        self.assertEqual(ret.code, 0, ret)

        # delete deleted(nonexistent) offline_syntax
        body = VoiceDeleteOfflineSyntax(grammar=grammar)
        ret = self.api_instance.delete_voice_offline_syntax(body=body)
        self.assertEqual(ret.code, 1, ret)

    def test_delete_voice_tts(self):
        """Test case for delete_voice_tts

        Stop all text to speech  # noqa: E501
        """
        tts = '江山如此多娇，引无数英雄竞折腰'
        timestamp = int(time.time())
        body = VoiceTTSStr(tts=tts, interrupt=True, timestamp=timestamp)
        ret = self.api_instance.put_voice_tts(body)
        self.assertEqual(ret.code, 0, ret)

        ret = self.api_instance.delete_voice_tts()
        self.assertEqual(ret.code, 0, ret)

    def test_get_voice_asr(self):
        """Test case for get_voice_asr

        Get automatic speech recognition working status  # noqa: E501
        """
        # start asr task
        timestamp = int(time.time())
        body = VoiceAsrOption(continues=True, timestamp=timestamp)
        self.api_instance.put_voice_asr(body=body)
        # get asr status
        ret = self.api_instance.get_voice_asr()
        self.assertEqual(ret.code, 0, ret)
        self.assertEqual(ret.status, 'run', ret)
        time.sleep(1.0)

        # stop asr task
        ret = self.api_instance.delete_voice_asr()
        self.assertEqual(ret.code, 0, ret)
        # get asr status
        ret = self.api_instance.get_voice_asr()
        self.assertEqual(ret.code, 0, ret)
        self.assertEqual(ret.status, 'idle', ret)

    def test_get_voice_iat(self):
        """Test case for get_voice_iat

        Get auto transform(iat) result  # noqa: E501
        """
        # start iat task
        timestamp = int(time.time())
        body = VoiceIatRequest(timestamp=timestamp)
        ret = self.api_instance.put_voice_iat(body=body)
        self.assertEqual(ret.code, 0, ret)
        # get iat status
        ret = self.api_instance.get_voice_iat()
        self.assertEqual(ret.code, 0, ret)
        self.assertEqual(ret.status, 'run', ret)
        time.sleep(1.0)

        # stop iat task
        ret = self.api_instance.delete_voice_iat()
        self.assertEqual(ret.code, 0, ret)
        # get iat status
        ret = self.api_instance.get_voice_iat()
        self.assertEqual(ret.code, 0, ret)
        self.assertEqual(ret.status, 'idle', ret)

    def test_get_voice_offline_syntax(self):
        """Test case for get_voice_offline_syntax

        Get offline grammar configuration  # noqa: E501
        """
        # create offline_syntax
        rules = [
            {
                "name": "want",
                "value": "我想|我要|请|帮我|我想要|请帮我"
            },
            {
                "name": "dialpre",
                "value": "打电话给!id(10001)|打给!id(10001)|拨打!id(10001)|拨打电话给!id(10001)|呼叫!id(10001)| 打一个电话给!id(10001)|打个电话给!id(10001)|给|拨通!id(10001)| 接通!id(10001)|呼叫!id(10001)|呼叫给!id(10001)|打!id(10001)"
            },
            {
                "name": "contact",
                "value": "丁伟"
            },
            {
                "name": "dialsuf",
                "value": "打电话!id(10001)|打个电话!id(10001)|打一个电话!id(10001)| 拨打电话!id(10001)|拨电话!id(10001)|拨个电话!id(10001)|呼个电话!id(10001)| 的电话!id(10001)|的号码!id(10001)|的手机!id(10001)| 的办公电话!id(10001)|的移动号码!id(10001)|的联通号码!id(10001)| 的电信号码!id(10001)|客服电话!id(10001)"
            }
        ]
        grammar = str(int(time.time()))
        slot = []
        for rule in rules:
            slot.append(VoiceOfflineSlot(name=rule['name']))
        start = grammar + 'Start'
        startinfo = ''
        for r in rules:
            if r == rules[0] or r == rules[-1]:
                startinfo += '[<' + r['name'] + '>]'
            else:
                startinfo += '<' + r['name'] + '>'
            startinfo += '|' if r != rules[-1] else ''
        rule = []
        for r in rules:
            temp = VoiceOfflineSyntaxRule(name=r['name'], value=r['value'])
            rule.append(temp)
        body = VoicePostOfflineSyntax(grammar=grammar, slot=slot, start=start, startinfo=startinfo, rule=rule)
        ret = self.api_instance.post_voice_offline_syntax(body=body)
        self.assertEqual(ret.code, 0, ret)

        # get offline_syntax
        ret = self.api_instance.get_voice_offline_syntax(body=grammar)  # return VoiceGetOfflineSyntaxResponse instance
        self.assertEqual(ret.to_str(), body.to_str(), ret)

        # delete offline_syntax
        body = VoiceDeleteOfflineSyntax(grammar=grammar)
        ret = self.api_instance.delete_voice_offline_syntax(body=body)
        self.assertEqual(ret.code, 0, ret)

    def test_get_voice_offline_syntax_grammars(self):
        """Test case for get_voice_offline_syntax_grammars

        Get offline grammars' name  # noqa: E501
        """
        # get offline_syntax grammars
        ret = self.api_instance.get_voice_offline_syntax_grammars()  # return VoiceGetOfflineSyntaxGrammarsResponse instance
        found = False
        for name in ret.grammar:
            if name.name == 'default':
                found = True
                break
        self.assertEqual(found, True, ret)

    def test_get_voice_tts(self):
        """Test case for get_voice_tts

        Get specified or current working status  # noqa: E501
        """
        # start tts task
        tts = '江山如此多娇，引无数英雄竞折腰'
        timestamp = int(time.time())
        body = VoiceTTSStr(tts=tts, interrupt=True, timestamp=timestamp)
        ret = self.api_instance.put_voice_tts(body)
        self.assertEqual(ret.code, 0, ret)
        # get current tts status
        ret = self.api_instance.get_voice_tts(timestamp=timestamp)
        self.assertEqual(ret.code, 0, ret)
        self.assertEqual(ret.status, 'build', ret)
        # duration depends on the length of tts text
        time.sleep(0.5)
        # get current tts status
        ret = self.api_instance.get_voice_tts(timestamp=timestamp)
        self.assertEqual(ret.code, 0, ret)
        self.assertEqual(ret.status, 'run', ret)
        time.sleep(3.0)
        # get current tts status
        ret = self.api_instance.get_voice_tts(timestamp=timestamp)
        self.assertEqual(ret.code, 0, ret)
        self.assertEqual(ret.status, 'idle', ret)

    def test_post_voice_offline_syntax(self):
        """Test case for post_voice_offline_syntax

        Add a new offline grammar  # noqa: E501
        """
        # create offline_syntax
        rules = [
            {
                "name": "want",
                "value": "我想|我要|请|帮我|我想要|请帮我"
            },
            {
                "name": "dialpre",
                "value": "打电话给!id(10001)|打给!id(10001)|拨打!id(10001)|拨打电话给!id(10001)|呼叫!id(10001)| 打一个电话给!id(10001)|打个电话给!id(10001)|给|拨通!id(10001)| 接通!id(10001)|呼叫!id(10001)|呼叫给!id(10001)|打!id(10001)"
            },
            {
                "name": "contact",
                "value": "丁伟"
            },
            {
                "name": "dialsuf",
                "value": "打电话!id(10001)|打个电话!id(10001)|打一个电话!id(10001)| 拨打电话!id(10001)|拨电话!id(10001)|拨个电话!id(10001)|呼个电话!id(10001)| 的电话!id(10001)|的号码!id(10001)|的手机!id(10001)| 的办公电话!id(10001)|的移动号码!id(10001)|的联通号码!id(10001)| 的电信号码!id(10001)|客服电话!id(10001)"
            }
        ]
        grammar = str(int(time.time()))
        slot = []
        for rule in rules:
            slot.append(VoiceOfflineSlot(name=rule['name']))
        start = grammar + 'Start'
        startinfo = ''
        for r in rules:
            if r == rules[0] or r == rules[-1]:
                startinfo += '[<' + r['name'] + '>]'
            else:
                startinfo += '<' + r['name'] + '>'
            startinfo += '|' if r != rules[-1] else ''
        rule = []
        for r in rules:
            temp = VoiceOfflineSyntaxRule(name=r['name'], value=r['value'])
            rule.append(temp)
        body = VoicePostOfflineSyntax(grammar=grammar, slot=slot, start=start, startinfo=startinfo, rule=rule)
        ret = self.api_instance.post_voice_offline_syntax(body=body)
        self.assertEqual(ret.code, 0, ret)

        # get offline_syntax grammars
        ret = self.api_instance.get_voice_offline_syntax_grammars()  # return VoiceGetOfflineSyntaxGrammarsResponse instance
        found = False
        for name in ret.grammar:
            if name.name == grammar:
                found = True
                break
        self.assertEqual(found, True, ret)

        # delete offline_syntax
        body = VoiceDeleteOfflineSyntax(grammar=grammar)
        ret = self.api_instance.delete_voice_offline_syntax(body=body)
        self.assertEqual(ret.code, 0, ret)

        # get offline_syntax grammars
        ret = self.api_instance.get_voice_offline_syntax_grammars()  # return VoiceGetOfflineSyntaxGrammarsResponse instance
        found = False
        for name in ret.grammar:
            if name.name == grammar:
                found = True
                break
        self.assertEqual(found, False, ret)

    def test_put_voice_asr(self):
        """Test case for put_voice_asr

        Start automatic speech recognition  # noqa: E501
        """
        # start asr task
        timestamp = int(time.time())
        body = VoiceAsrOption(continues=True, timestamp=timestamp)
        self.api_instance.put_voice_asr(body=body)

        # stop asr task
        ret = self.api_instance.delete_voice_asr()
        self.assertEqual(ret.code, 0, ret)

    def test_put_voice_iat(self):
        """Test case for put_voice_iat

        Start auto transform  # noqa: E501
        """
        # start iat task
        timestamp = int(time.time())
        body = VoiceIatRequest(timestamp=timestamp)
        ret = self.api_instance.put_voice_iat(body=body)
        self.assertEqual(ret.code, 0, ret)

        # stop iat task
        ret = self.api_instance.delete_voice_iat()
        self.assertEqual(ret.code, 0, ret)

    def test_put_voice_offline_syntax(self):
        """Test case for put_voice_offline_syntax

        Update offline grammar based grammar's name  # noqa: E501
        """
        # create offline_syntax
        rules = [
            {
                "name": "want",
                "value": "我想|我要|请|帮我|我想要|请帮我"
            },
            {
                "name": "dialpre",
                "value": "打电话给!id(10001)|打给!id(10001)|拨打!id(10001)|拨打电话给!id(10001)|呼叫!id(10001)| 打一个电话给!id(10001)|打个电话给!id(10001)|给|拨通!id(10001)| 接通!id(10001)|呼叫!id(10001)|呼叫给!id(10001)|打!id(10001)"
            },
            {
                "name": "contact",
                "value": "丁伟"
            },
            {
                "name": "dialsuf",
                "value": "打电话!id(10001)|打个电话!id(10001)|打一个电话!id(10001)| 拨打电话!id(10001)|拨电话!id(10001)|拨个电话!id(10001)|呼个电话!id(10001)| 的电话!id(10001)|的号码!id(10001)|的手机!id(10001)| 的办公电话!id(10001)|的移动号码!id(10001)|的联通号码!id(10001)| 的电信号码!id(10001)|客服电话!id(10001)"
            }
        ]
        grammar = str(int(time.time()))
        slot = []
        for rule in rules:
            slot.append(VoiceOfflineSlot(name=rule['name']))
        start = grammar + 'Start'
        startinfo = ''
        for r in rules:
            if r == rules[0] or r == rules[-1]:
                startinfo += '[<' + r['name'] + '>]'
            else:
                startinfo += '<' + r['name'] + '>'
            startinfo += '|' if r != rules[-1] else ''
        rule = []
        for r in rules:
            temp = VoiceOfflineSyntaxRule(name=r['name'], value=r['value'])
            rule.append(temp)
        body = VoicePostOfflineSyntax(grammar=grammar, slot=slot, start=start, startinfo=startinfo, rule=rule)
        ret = self.api_instance.post_voice_offline_syntax(body=body)
        self.assertEqual(ret.code, 0, ret)

        # set offline_syntax
        index = body.rule.index(VoiceOfflineSyntaxRule(name='contact', value='丁伟'))
        body.rule[index].value = '俊文'
        ret = self.api_instance.put_voice_offline_syntax(body=body)
        self.assertEqual(ret.code, 0, ret)

        # get offline_syntax
        ret = self.api_instance.get_voice_offline_syntax(body=grammar)  # return VoiceGetOfflineSyntaxResponse instance
        found = False
        for r in ret.rule:
            if r.name == 'contact' and r.value == '俊文':
                found = True
                break
        self.assertEqual(found, True, ret)

        # delete offline_syntax
        body = VoiceDeleteOfflineSyntax(grammar=grammar)
        ret = self.api_instance.delete_voice_offline_syntax(body=body)
        self.assertEqual(ret.code, 0, ret)

    def test_put_voice_tts(self):
        """Test case for put_voice_tts

        Start text to speech  # noqa: E501
        """
        # start tts task
        tts = '江山如此多娇，引无数英雄竞折腰'
        timestamp = int(time.time())
        body = VoiceTTSStr(tts=tts, interrupt=True, timestamp=timestamp)
        ret = self.api_instance.put_voice_tts(body)
        self.assertEqual(ret.code, 0, ret)
        time.sleep(3.0)


if __name__ == '__main__':
    unittest.main()
